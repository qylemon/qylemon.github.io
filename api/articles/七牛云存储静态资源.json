{"title":"七牛云存储静态资源","slug":"七牛云存储静态资源","date":"2020-02-15T07:38:48.263Z","updated":"2020-02-28T02:38:37.606Z","comments":true,"path":"api/articles/七牛云存储静态资源.json","excerpt":" [Figure] 七牛云通常用来存储图片等静态资源，记录下操作过程","covers":["https://picabstract-preview-ftn.weiyun.com/ftn_pic_abs_v3/a0049a684739eedc2ddeae4971d9871bc8593e772dbf04560e039eb998f9d6be32bf32acbe884852b03a679927314a10?pictype=scale&amp;from=30113&amp;version=3.3.3.3&amp;uin=1643994375&amp;fname=u%3D536107637%2C2648454759%26fm%3D26%26gp%3D0.jpg&amp;size=750"],"content":"<p><img src=\"https://picabstract-preview-ftn.weiyun.com/ftn_pic_abs_v3/a0049a684739eedc2ddeae4971d9871bc8593e772dbf04560e039eb998f9d6be32bf32acbe884852b03a679927314a10?pictype=scale&amp;from=30113&amp;version=3.3.3.3&amp;uin=1643994375&amp;fname=u%3D536107637%2C2648454759%26fm%3D26%26gp%3D0.jpg&amp;size=750\" alt><br>七牛云通常用来存储图片等静态资源，记录下操作过程<a id=\"more\"></a></p>\n<h2 id=\"后端操作如下\"><a href=\"#后端操作如下\" class=\"headerlink\" title=\"后端操作如下\"></a>后端操作如下</h2><h3 id=\"引入pom文件\"><a href=\"#引入pom文件\" class=\"headerlink\" title=\"引入pom文件\"></a>引入pom文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.qiniu&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;qiniu-java-sdk&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;7.1.1&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">       &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt;</span><br><span class=\"line\">       &lt;artifactId&gt;okhttp&lt;/artifactId&gt;</span><br><span class=\"line\">       &lt;version&gt;3.3.1&lt;/version&gt;</span><br><span class=\"line\">       &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class=\"line\">   &lt;/dependency&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">       &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;</span><br><span class=\"line\">       &lt;artifactId&gt;gson&lt;/artifactId&gt;</span><br><span class=\"line\">       &lt;version&gt;2.6.2&lt;/version&gt;</span><br><span class=\"line\">       &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class=\"line\">   &lt;/dependency&gt;</span><br><span class=\"line\">   &lt;dependency&gt;</span><br><span class=\"line\">       &lt;groupId&gt;com.qiniu&lt;/groupId&gt;</span><br><span class=\"line\">       &lt;artifactId&gt;happy-dns-java&lt;/artifactId&gt;</span><br><span class=\"line\">       &lt;version&gt;0.1.4&lt;/version&gt;</span><br><span class=\"line\">       &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"util文件\"><a href=\"#util文件\" class=\"headerlink\" title=\"util文件\"></a>util文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.xx.xx.util;</span><br><span class=\"line\">// 包部分以省略</span><br><span class=\"line\">import java.io.IOException;</span><br><span class=\"line\">import java.util.*;</span><br><span class=\"line\">import com.qiniu.*;</span><br><span class=\"line\">import okhttp3.*;</span><br><span class=\"line\"></span><br><span class=\"line\">public class QiniuUtil &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 设置需要操作的账号的AK和SK</span><br><span class=\"line\">    private static final String ACCESS_KEY = &quot;你的ACCESS_KEY&quot;;</span><br><span class=\"line\">    private static final String SECRET_KEY = &quot;你的SECRET_KEY&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 要上传的空间</span><br><span class=\"line\">    private static final String bucketname = &quot;你的空间名称&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 密钥</span><br><span class=\"line\">    private static final Auth auth = Auth.create(ACCESS_KEY, SECRET_KEY);</span><br><span class=\"line\"></span><br><span class=\"line\">    private static final String DOMAIN = &quot;你的图片上传路径&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    private static final String style = &quot;自定义的图片样式&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getUpToken() &#123;        </span><br><span class=\"line\">        return auth.uploadToken(bucketname, null, 3600, new StringMap().put(&quot;insertOnly&quot;, 1));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // 普通上传</span><br><span class=\"line\">    public String upload(String filePath, String fileName) throws IOException &#123;</span><br><span class=\"line\">        // 创建上传对象</span><br><span class=\"line\">        UploadManager uploadManager = new UploadManager();</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            // 调用put方法上传</span><br><span class=\"line\">            String token = auth.uploadToken(bucketname);</span><br><span class=\"line\">            if(token.isEmpty() || token==&quot;&quot;) &#123;</span><br><span class=\"line\">                System.out.println(&quot;未获取到token，请重试！&quot;);</span><br><span class=\"line\">                return null;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            Response res = uploadManager.put(filePath, fileName, token);</span><br><span class=\"line\">            // 打印返回的信息</span><br><span class=\"line\">            System.out.println(res.bodyString());</span><br><span class=\"line\">            if (res.isOK()) &#123;</span><br><span class=\"line\">                Ret ret = res.jsonToObject(Ret.class);</span><br><span class=\"line\">                //如果不需要对图片进行样式处理，则使用以下方式即可</span><br><span class=\"line\">                //return DOMAIN + ret.key;</span><br><span class=\"line\">                return DOMAIN + ret.key + &quot;?&quot; + style;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (QiniuException e) &#123;</span><br><span class=\"line\">            Response r = e.response;</span><br><span class=\"line\">            // 请求失败时打印的异常的信息</span><br><span class=\"line\">            System.out.println(r.toString());</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                // 响应的文本信息</span><br><span class=\"line\">                System.out.println(r.bodyString());</span><br><span class=\"line\">            &#125; catch (QiniuException e1) &#123;</span><br><span class=\"line\">                // ignore</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    //base64方式上传</span><br><span class=\"line\">    public String put64image(byte[] base64, String key) throws Exception&#123;</span><br><span class=\"line\">        String file64 = Base64.encodeToString(base64, 0);</span><br><span class=\"line\">        Integer l = base64.length;</span><br><span class=\"line\">        String url = &quot;http://upload.qiniu.com/putb64/&quot; + l + &quot;/key/&quot;+ UrlSafeBase64.encodeToString(key);      </span><br><span class=\"line\">        //非华东空间需要根据注意事项 1 修改上传域名</span><br><span class=\"line\">        RequestBody rb = RequestBody.create(null, file64);</span><br><span class=\"line\">        Request request = new Request.Builder().</span><br><span class=\"line\">                url(url).</span><br><span class=\"line\">                addHeader(&quot;Content-Type&quot;, &quot;application/octet-stream&quot;)</span><br><span class=\"line\">                .addHeader(&quot;Authorization&quot;, &quot;UpToken &quot; + getUpToken())</span><br><span class=\"line\">                .post(rb).build();</span><br><span class=\"line\">        //System.out.println(request.headers());</span><br><span class=\"line\">        OkHttpClient client = new OkHttpClient();</span><br><span class=\"line\">        okhttp3.Response response = client.newCall(request).execute();</span><br><span class=\"line\">        System.out.println(response);</span><br><span class=\"line\">        //如果不需要添加图片样式，使用以下方式</span><br><span class=\"line\">        //return DOMAIN + key;</span><br><span class=\"line\">        return DOMAIN + key + &quot;?&quot; + style;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    // 普通删除(暂未使用以下方法，未测试)</span><br><span class=\"line\">    public void delete(String key) throws IOException &#123;</span><br><span class=\"line\">        // 实例化一个BucketManager对象</span><br><span class=\"line\">        BucketManager bucketManager = new BucketManager(auth);</span><br><span class=\"line\">        // 此处的25是去掉：http://xxxx.com/,剩下的key就是图片在七牛云的名称,截取到问号 问号后是图片的水印处理</span><br><span class=\"line\">        key = key.substring(25,key.indexOf(&quot;?&quot;));</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            // 调用delete方法移动文件</span><br><span class=\"line\">            bucketManager.delete(bucketname, key);</span><br><span class=\"line\">        &#125; catch (QiniuException e) &#123;</span><br><span class=\"line\">            // 捕获异常信息</span><br><span class=\"line\">            Response r = e.response;</span><br><span class=\"line\">            System.out.println(r.toString());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    class Ret &#123;</span><br><span class=\"line\">        public long fsize;</span><br><span class=\"line\">        public String key;</span><br><span class=\"line\">        public String hash;</span><br><span class=\"line\">        public int width;</span><br><span class=\"line\">        public int height;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"controller代码\"><a href=\"#controller代码\" class=\"headerlink\" title=\"controller代码\"></a>controller代码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@ResponseBody</span><br><span class=\"line\">@PostMapping(&quot;/uploadImg&quot;)</span><br><span class=\"line\">public ResultInfo uploadImg(@RequestParam MultipartFile image, HttpServletRequest request) &#123;</span><br><span class=\"line\">    ResultInfo result = new ResultInfo();</span><br><span class=\"line\">    if (image.isEmpty()) &#123;</span><br><span class=\"line\">        result.setCode(400);</span><br><span class=\"line\">        result.setMsg(&quot;文件为空，请重新上传&quot;);</span><br><span class=\"line\">        return result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        byte[] bytes = image.getBytes();</span><br><span class=\"line\">        String imageName = UUID.randomUUID().toString();</span><br><span class=\"line\"></span><br><span class=\"line\">        QiniuUtil qiniuUtil = new QiniuUtil();</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            //使用base64方式上传到七牛云</span><br><span class=\"line\">            String url = qiniuUtil.put64image(bytes, imageName);</span><br><span class=\"line\">            result.setCode(200);</span><br><span class=\"line\">            result.setMsg(&quot;文件上传成功&quot;);</span><br><span class=\"line\">\t\t\t//此处需要引入鉴黄的判断</span><br><span class=\"line\">\t\t\tif(qiniuUtil.pornography(url))&#123;</span><br><span class=\"line\">            \tresult.setInfo(url);</span><br><span class=\"line\">\t\t\t&#125;else&#123;</span><br><span class=\"line\">\t\t\t\t// 处理删除业务逻辑 并返回提示\t\t\t</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return result;</span><br><span class=\"line\">    &#125; catch (IOException e) &#123;</span><br><span class=\"line\">        result.setCode(500);</span><br><span class=\"line\">        result.setMsg(&quot;文件上传发生异常！&quot;);</span><br><span class=\"line\">        return result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如此就能够实现上传功能了，但听说在上传前还需要鉴识颜色，就需要对util进行一些小幅修改，修改如下。</p>\n<h2 id=\"修改操作如下\"><a href=\"#修改操作如下\" class=\"headerlink\" title=\"修改操作如下\"></a>修改操作如下</h2><h3 id=\"修改pom包版本\"><a href=\"#修改pom包版本\" class=\"headerlink\" title=\"修改pom包版本\"></a>修改pom包版本</h3><p>如未修改高版本pom文件 该部分会出现<code>com.qiniu.common.QiniuException</code>异常<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.qiniu&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;qiniu-java-sdk&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;7.2.7&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"util文件种添加鉴别部分代码\"><a href=\"#util文件种添加鉴别部分代码\" class=\"headerlink\" title=\"util文件种添加鉴别部分代码\"></a>util文件种添加鉴别部分代码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static Boolean pornography(String pis)&#123;</span><br><span class=\"line\">    Auth auth = Auth.create(ACCESS_KEY, SECRET_KEY);</span><br><span class=\"line\"></span><br><span class=\"line\">    String url = &quot;http://ai.qiniuapi.com/v3/image/censor&quot;;</span><br><span class=\"line\">    String host = &quot;ai.qiniuapi.com&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    String body = &quot;&#123; \\&quot;data\\&quot;: &#123; \\&quot;uri\\&quot;: \\&quot;&quot;+pis+&quot;\\&quot; &#125;, \\&quot;params\\&quot;: &#123; \\&quot;scenes\\&quot;: [ \\&quot;pulp\\&quot;, \\&quot;terror\\&quot;, \\&quot;politician\\&quot; ] &#125; &#125;&quot;;</span><br><span class=\"line\">    String contentType = &quot;application/json&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    String method = &quot;POST&quot;;</span><br><span class=\"line\">    String qiniuToken = &quot;Qiniu &quot; + auth.signRequestV2(url, method, body.getBytes(), contentType);</span><br><span class=\"line\"></span><br><span class=\"line\">    StringMap header = new StringMap();</span><br><span class=\"line\">    header.put(&quot;Host&quot;, host);</span><br><span class=\"line\">    header.put(&quot;Authorization&quot;, qiniuToken);</span><br><span class=\"line\">    header.put(&quot;Content-Type&quot;, contentType);</span><br><span class=\"line\">    Client client = new Client();</span><br><span class=\"line\">    Response response = null;</span><br><span class=\"line\">    String str =&quot;&quot;;</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        response = client.post(url, body.getBytes(), header, contentType);</span><br><span class=\"line\">        str = response.bodyString();</span><br><span class=\"line\">    &#125; catch (QiniuException e) &#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (!str.equals(&quot;&quot;))&#123;</span><br><span class=\"line\">        JsonParser jp = new JsonParser();</span><br><span class=\"line\">        //将json字符串转成json对象</span><br><span class=\"line\">        JsonObject jo = jp.parse(str).getAsJsonObject();</span><br><span class=\"line\">        String label = jo.get(&quot;result&quot;).getAsJsonObject().get(&quot;scenes&quot;).getAsJsonObject()</span><br><span class=\"line\">                .get(&quot;pulp&quot;).getAsJsonObject().get(&quot;details&quot;).getAsJsonArray().get(0).getAsJsonObject().get(&quot;label&quot;).getAsString();</span><br><span class=\"line\">        if (label.equals(&quot;pulp&quot;))&#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改util部分代码\"><a href=\"#修改util部分代码\" class=\"headerlink\" title=\"修改util部分代码\"></a>修改util部分代码</h3><ol>\n<li><p>添加空间地区类参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 空间的地区类型</span><br><span class=\"line\">//Region.region0() 华东一 其他请参考七牛云文档</span><br><span class=\"line\">public Configuration getConfiguration()&#123;</span><br><span class=\"line\">    Configuration cfg = new Configuration(Region.region0());</span><br><span class=\"line\">    return cfg;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改普通上传方法中的 创建上传对象</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 创建上传对象</span><br><span class=\"line\">UploadManager uploadManager = new UploadManager(getConfiguration());</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>如写了删除方法也需要在方法中修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 实例化一个BucketManager对象</span><br><span class=\"line\">BucketManager bucketManager = new BucketManager(auth,getConfiguration());</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>这样工具类就整合完成了，后续如有此类知识点会在文中补充</p>\n<h2 id=\"end\"><a href=\"#end\" class=\"headerlink\" title=\"end\"></a>end</h2><p>已经过测试，注意点已补充在文中。</p>\n<blockquote>\n<p>cname所绑定的域名一定要尾部加上/ 或者在util中修改拼接的方式</p>\n</blockquote>\n","more":"</p>\n<h2 id=\"后端操作如下\"><a href=\"#后端操作如下\" class=\"headerlink\" title=\"后端操作如下\"></a>后端操作如下</h2><h3 id=\"引入pom文件\"><a href=\"#引入pom文件\" class=\"headerlink\" title=\"引入pom文件\"></a>引入pom文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.qiniu&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;qiniu-java-sdk&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;7.1.1&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">       &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt;</span><br><span class=\"line\">       &lt;artifactId&gt;okhttp&lt;/artifactId&gt;</span><br><span class=\"line\">       &lt;version&gt;3.3.1&lt;/version&gt;</span><br><span class=\"line\">       &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class=\"line\">   &lt;/dependency&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">       &lt;groupId&gt;com.google.code.gson&lt;/groupId&gt;</span><br><span class=\"line\">       &lt;artifactId&gt;gson&lt;/artifactId&gt;</span><br><span class=\"line\">       &lt;version&gt;2.6.2&lt;/version&gt;</span><br><span class=\"line\">       &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class=\"line\">   &lt;/dependency&gt;</span><br><span class=\"line\">   &lt;dependency&gt;</span><br><span class=\"line\">       &lt;groupId&gt;com.qiniu&lt;/groupId&gt;</span><br><span class=\"line\">       &lt;artifactId&gt;happy-dns-java&lt;/artifactId&gt;</span><br><span class=\"line\">       &lt;version&gt;0.1.4&lt;/version&gt;</span><br><span class=\"line\">       &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class=\"line\">&lt;dependency&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"util文件\"><a href=\"#util文件\" class=\"headerlink\" title=\"util文件\"></a>util文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package com.xx.xx.util;</span><br><span class=\"line\">// 包部分以省略</span><br><span class=\"line\">import java.io.IOException;</span><br><span class=\"line\">import java.util.*;</span><br><span class=\"line\">import com.qiniu.*;</span><br><span class=\"line\">import okhttp3.*;</span><br><span class=\"line\"></span><br><span class=\"line\">public class QiniuUtil &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 设置需要操作的账号的AK和SK</span><br><span class=\"line\">    private static final String ACCESS_KEY = &quot;你的ACCESS_KEY&quot;;</span><br><span class=\"line\">    private static final String SECRET_KEY = &quot;你的SECRET_KEY&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 要上传的空间</span><br><span class=\"line\">    private static final String bucketname = &quot;你的空间名称&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 密钥</span><br><span class=\"line\">    private static final Auth auth = Auth.create(ACCESS_KEY, SECRET_KEY);</span><br><span class=\"line\"></span><br><span class=\"line\">    private static final String DOMAIN = &quot;你的图片上传路径&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    private static final String style = &quot;自定义的图片样式&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getUpToken() &#123;        </span><br><span class=\"line\">        return auth.uploadToken(bucketname, null, 3600, new StringMap().put(&quot;insertOnly&quot;, 1));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // 普通上传</span><br><span class=\"line\">    public String upload(String filePath, String fileName) throws IOException &#123;</span><br><span class=\"line\">        // 创建上传对象</span><br><span class=\"line\">        UploadManager uploadManager = new UploadManager();</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            // 调用put方法上传</span><br><span class=\"line\">            String token = auth.uploadToken(bucketname);</span><br><span class=\"line\">            if(token.isEmpty() || token==&quot;&quot;) &#123;</span><br><span class=\"line\">                System.out.println(&quot;未获取到token，请重试！&quot;);</span><br><span class=\"line\">                return null;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            Response res = uploadManager.put(filePath, fileName, token);</span><br><span class=\"line\">            // 打印返回的信息</span><br><span class=\"line\">            System.out.println(res.bodyString());</span><br><span class=\"line\">            if (res.isOK()) &#123;</span><br><span class=\"line\">                Ret ret = res.jsonToObject(Ret.class);</span><br><span class=\"line\">                //如果不需要对图片进行样式处理，则使用以下方式即可</span><br><span class=\"line\">                //return DOMAIN + ret.key;</span><br><span class=\"line\">                return DOMAIN + ret.key + &quot;?&quot; + style;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; catch (QiniuException e) &#123;</span><br><span class=\"line\">            Response r = e.response;</span><br><span class=\"line\">            // 请求失败时打印的异常的信息</span><br><span class=\"line\">            System.out.println(r.toString());</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                // 响应的文本信息</span><br><span class=\"line\">                System.out.println(r.bodyString());</span><br><span class=\"line\">            &#125; catch (QiniuException e1) &#123;</span><br><span class=\"line\">                // ignore</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    //base64方式上传</span><br><span class=\"line\">    public String put64image(byte[] base64, String key) throws Exception&#123;</span><br><span class=\"line\">        String file64 = Base64.encodeToString(base64, 0);</span><br><span class=\"line\">        Integer l = base64.length;</span><br><span class=\"line\">        String url = &quot;http://upload.qiniu.com/putb64/&quot; + l + &quot;/key/&quot;+ UrlSafeBase64.encodeToString(key);      </span><br><span class=\"line\">        //非华东空间需要根据注意事项 1 修改上传域名</span><br><span class=\"line\">        RequestBody rb = RequestBody.create(null, file64);</span><br><span class=\"line\">        Request request = new Request.Builder().</span><br><span class=\"line\">                url(url).</span><br><span class=\"line\">                addHeader(&quot;Content-Type&quot;, &quot;application/octet-stream&quot;)</span><br><span class=\"line\">                .addHeader(&quot;Authorization&quot;, &quot;UpToken &quot; + getUpToken())</span><br><span class=\"line\">                .post(rb).build();</span><br><span class=\"line\">        //System.out.println(request.headers());</span><br><span class=\"line\">        OkHttpClient client = new OkHttpClient();</span><br><span class=\"line\">        okhttp3.Response response = client.newCall(request).execute();</span><br><span class=\"line\">        System.out.println(response);</span><br><span class=\"line\">        //如果不需要添加图片样式，使用以下方式</span><br><span class=\"line\">        //return DOMAIN + key;</span><br><span class=\"line\">        return DOMAIN + key + &quot;?&quot; + style;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    // 普通删除(暂未使用以下方法，未测试)</span><br><span class=\"line\">    public void delete(String key) throws IOException &#123;</span><br><span class=\"line\">        // 实例化一个BucketManager对象</span><br><span class=\"line\">        BucketManager bucketManager = new BucketManager(auth);</span><br><span class=\"line\">        // 此处的25是去掉：http://xxxx.com/,剩下的key就是图片在七牛云的名称,截取到问号 问号后是图片的水印处理</span><br><span class=\"line\">        key = key.substring(25,key.indexOf(&quot;?&quot;));</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            // 调用delete方法移动文件</span><br><span class=\"line\">            bucketManager.delete(bucketname, key);</span><br><span class=\"line\">        &#125; catch (QiniuException e) &#123;</span><br><span class=\"line\">            // 捕获异常信息</span><br><span class=\"line\">            Response r = e.response;</span><br><span class=\"line\">            System.out.println(r.toString());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    class Ret &#123;</span><br><span class=\"line\">        public long fsize;</span><br><span class=\"line\">        public String key;</span><br><span class=\"line\">        public String hash;</span><br><span class=\"line\">        public int width;</span><br><span class=\"line\">        public int height;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"controller代码\"><a href=\"#controller代码\" class=\"headerlink\" title=\"controller代码\"></a>controller代码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@ResponseBody</span><br><span class=\"line\">@PostMapping(&quot;/uploadImg&quot;)</span><br><span class=\"line\">public ResultInfo uploadImg(@RequestParam MultipartFile image, HttpServletRequest request) &#123;</span><br><span class=\"line\">    ResultInfo result = new ResultInfo();</span><br><span class=\"line\">    if (image.isEmpty()) &#123;</span><br><span class=\"line\">        result.setCode(400);</span><br><span class=\"line\">        result.setMsg(&quot;文件为空，请重新上传&quot;);</span><br><span class=\"line\">        return result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        byte[] bytes = image.getBytes();</span><br><span class=\"line\">        String imageName = UUID.randomUUID().toString();</span><br><span class=\"line\"></span><br><span class=\"line\">        QiniuUtil qiniuUtil = new QiniuUtil();</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            //使用base64方式上传到七牛云</span><br><span class=\"line\">            String url = qiniuUtil.put64image(bytes, imageName);</span><br><span class=\"line\">            result.setCode(200);</span><br><span class=\"line\">            result.setMsg(&quot;文件上传成功&quot;);</span><br><span class=\"line\">\t\t\t//此处需要引入鉴黄的判断</span><br><span class=\"line\">\t\t\tif(qiniuUtil.pornography(url))&#123;</span><br><span class=\"line\">            \tresult.setInfo(url);</span><br><span class=\"line\">\t\t\t&#125;else&#123;</span><br><span class=\"line\">\t\t\t\t// 处理删除业务逻辑 并返回提示\t\t\t</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return result;</span><br><span class=\"line\">    &#125; catch (IOException e) &#123;</span><br><span class=\"line\">        result.setCode(500);</span><br><span class=\"line\">        result.setMsg(&quot;文件上传发生异常！&quot;);</span><br><span class=\"line\">        return result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>如此就能够实现上传功能了，但听说在上传前还需要鉴识颜色，就需要对util进行一些小幅修改，修改如下。</p>\n<h2 id=\"修改操作如下\"><a href=\"#修改操作如下\" class=\"headerlink\" title=\"修改操作如下\"></a>修改操作如下</h2><h3 id=\"修改pom包版本\"><a href=\"#修改pom包版本\" class=\"headerlink\" title=\"修改pom包版本\"></a>修改pom包版本</h3><p>如未修改高版本pom文件 该部分会出现<code>com.qiniu.common.QiniuException</code>异常<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.qiniu&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;qiniu-java-sdk&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;7.2.7&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"util文件种添加鉴别部分代码\"><a href=\"#util文件种添加鉴别部分代码\" class=\"headerlink\" title=\"util文件种添加鉴别部分代码\"></a>util文件种添加鉴别部分代码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static Boolean pornography(String pis)&#123;</span><br><span class=\"line\">    Auth auth = Auth.create(ACCESS_KEY, SECRET_KEY);</span><br><span class=\"line\"></span><br><span class=\"line\">    String url = &quot;http://ai.qiniuapi.com/v3/image/censor&quot;;</span><br><span class=\"line\">    String host = &quot;ai.qiniuapi.com&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    String body = &quot;&#123; \\&quot;data\\&quot;: &#123; \\&quot;uri\\&quot;: \\&quot;&quot;+pis+&quot;\\&quot; &#125;, \\&quot;params\\&quot;: &#123; \\&quot;scenes\\&quot;: [ \\&quot;pulp\\&quot;, \\&quot;terror\\&quot;, \\&quot;politician\\&quot; ] &#125; &#125;&quot;;</span><br><span class=\"line\">    String contentType = &quot;application/json&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    String method = &quot;POST&quot;;</span><br><span class=\"line\">    String qiniuToken = &quot;Qiniu &quot; + auth.signRequestV2(url, method, body.getBytes(), contentType);</span><br><span class=\"line\"></span><br><span class=\"line\">    StringMap header = new StringMap();</span><br><span class=\"line\">    header.put(&quot;Host&quot;, host);</span><br><span class=\"line\">    header.put(&quot;Authorization&quot;, qiniuToken);</span><br><span class=\"line\">    header.put(&quot;Content-Type&quot;, contentType);</span><br><span class=\"line\">    Client client = new Client();</span><br><span class=\"line\">    Response response = null;</span><br><span class=\"line\">    String str =&quot;&quot;;</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        response = client.post(url, body.getBytes(), header, contentType);</span><br><span class=\"line\">        str = response.bodyString();</span><br><span class=\"line\">    &#125; catch (QiniuException e) &#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (!str.equals(&quot;&quot;))&#123;</span><br><span class=\"line\">        JsonParser jp = new JsonParser();</span><br><span class=\"line\">        //将json字符串转成json对象</span><br><span class=\"line\">        JsonObject jo = jp.parse(str).getAsJsonObject();</span><br><span class=\"line\">        String label = jo.get(&quot;result&quot;).getAsJsonObject().get(&quot;scenes&quot;).getAsJsonObject()</span><br><span class=\"line\">                .get(&quot;pulp&quot;).getAsJsonObject().get(&quot;details&quot;).getAsJsonArray().get(0).getAsJsonObject().get(&quot;label&quot;).getAsString();</span><br><span class=\"line\">        if (label.equals(&quot;pulp&quot;))&#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"修改util部分代码\"><a href=\"#修改util部分代码\" class=\"headerlink\" title=\"修改util部分代码\"></a>修改util部分代码</h3><ol>\n<li><p>添加空间地区类参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 空间的地区类型</span><br><span class=\"line\">//Region.region0() 华东一 其他请参考七牛云文档</span><br><span class=\"line\">public Configuration getConfiguration()&#123;</span><br><span class=\"line\">    Configuration cfg = new Configuration(Region.region0());</span><br><span class=\"line\">    return cfg;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改普通上传方法中的 创建上传对象</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 创建上传对象</span><br><span class=\"line\">UploadManager uploadManager = new UploadManager(getConfiguration());</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>如写了删除方法也需要在方法中修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 实例化一个BucketManager对象</span><br><span class=\"line\">BucketManager bucketManager = new BucketManager(auth,getConfiguration());</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>这样工具类就整合完成了，后续如有此类知识点会在文中补充</p>\n<h2 id=\"end\"><a href=\"#end\" class=\"headerlink\" title=\"end\"></a>end</h2><p>已经过测试，注意点已补充在文中。</p>\n<blockquote>\n<p>cname所绑定的域名一定要尾部加上/ 或者在util中修改拼接的方式</p>\n</blockquote>","categories":[{"name":"静态存储","path":"api/categories/静态存储.json"}],"tags":[{"name":"静态存储","path":"api/tags/静态存储.json"}]}