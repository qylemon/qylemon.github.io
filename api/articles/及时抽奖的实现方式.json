{"title":"关于及时抽奖的实现","slug":"及时抽奖的实现方式","date":"2020-04-30T06:45:31.941Z","updated":"2020-05-06T15:27:37.178Z","comments":true,"path":"api/articles/及时抽奖的实现方式.json","excerpt":"关于一次及时抽奖的记录","covers":null,"content":"<p>关于一次及时抽奖的记录<a id=\"more\"></a>，这次的需求是时间规定、奖励规定以及不限制抽奖人数。</p>\n<h2 id=\"提要\"><a href=\"#提要\" class=\"headerlink\" title=\"提要\"></a>提要</h2><p>抽奖有多种实现方式 那么最常见的就是转盘了，通过扇区来决定奖项 此时奖品的概率和公平性就都体现了，但是在没有人数和概率规定的情况下显然不能够提现，这是想到了通过时间间隔来均分奖品，那么就通过时间和参与人虚拟了一个中奖概率同时体现了公平性，思路有了，如何实现呢？百度一下我就知道 下面记录一下看了之后的实现。</p>\n<h2 id=\"重点描述\"><a href=\"#重点描述\" class=\"headerlink\" title=\"重点描述\"></a>重点描述</h2><p>该抽奖主要是提现奖品的公平性和奖品的均匀分布 不会出现开始即抽完 后续无奖品 或 奖品有剩余的可能性。</p>\n<h2 id=\"实现如下\"><a href=\"#实现如下\" class=\"headerlink\" title=\"实现如下\"></a>实现如下</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.数据表</span><br><span class=\"line\">## 抽奖表</span><br><span class=\"line\">create table draw(</span><br><span class=\"line\">    id int not null auto_increment comment &apos;id&apos;,</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\tbegin_time datetime comment &apos;抽奖开始时间&apos;,</span><br><span class=\"line\">\tend_time datetime comment &apos;抽奖结束时间&apos;,</span><br><span class=\"line\">    primary key (id)\t</span><br><span class=\"line\">)</span><br><span class=\"line\">## 奖品表</span><br><span class=\"line\">create table prize(</span><br><span class=\"line\">    id int not null auto_increment comment &apos;id&apos;,</span><br><span class=\"line\">    name varchar(500) comment &apos;奖品名称&apos;,</span><br><span class=\"line\">    amount int comment &apos;奖品数量&apos;,</span><br><span class=\"line\">    balance int comment &apos;剩余数量&apos;,</span><br><span class=\"line\">    last_update_time datetime default CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP comment &apos;最后中奖时间&apos;,</span><br><span class=\"line\">    primary key (id)\t</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">## 中奖信息表</span><br><span class=\"line\">create table record(</span><br><span class=\"line\">    id int not null auto_increment comment &apos;id&apos;,</span><br><span class=\"line\">    prize_id int comment &apos;奖品id&apos;,</span><br><span class=\"line\">    release_time datetime default CURRENT_TIMESTAMP comment &apos;中奖时间&apos;,</span><br><span class=\"line\">    primary key (id)\t</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">2.代码实现</span><br><span class=\"line\">public static void getPrize()&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t//1. 首先获取当前抽奖的所有奖品是否还有剩余</span><br><span class=\"line\">\tif（getBalanceList == 0）&#123;</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;else&#123;</span><br><span class=\"line\">\t\t// 2. 随机一种用户可能抽中的奖品</span><br><span class=\"line\">\t\tprice = Random(...);</span><br><span class=\"line\">\t\tif(price.getBalance &lt;=0)&#123;</span><br><span class=\"line\">\t\t\treturn;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tlong beginTime = getBegin_time().getTime(); </span><br><span class=\"line\">        long endTime = getEnd_time().getTime(); </span><br><span class=\"line\">        long now = System.currentTimeMillis();</span><br><span class=\"line\"></span><br><span class=\"line\">        Integer currentAmount = getamount();                 // 总奖品数</span><br><span class=\"line\">    \tInteger currentBalance = getBalance();             // 总剩余数</span><br><span class=\"line\"></span><br><span class=\"line\">        long dataTime = (endTime - beginTime) / currentAmount;  // 时间单位</span><br><span class=\"line\">\t\tRandom rand = new Random(lastTime);</span><br><span class=\"line\">        long releaseTime = beginTime + (currentAmount - currentBalance) * dataTime + Math.abs(rand.nextLong()) % dataTime; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif(now&lt;releaseTime)&#123;</span><br><span class=\"line\">\t\t\t// 中奖</span><br><span class=\"line\">\t\t&#125;else&#123;</span><br><span class=\"line\">\t\t\treturn;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"end\"><a href=\"#end\" class=\"headerlink\" title=\"end\"></a>end</h2>","more":"，这次的需求是时间规定、奖励规定以及不限制抽奖人数。</p>\n<h2 id=\"提要\"><a href=\"#提要\" class=\"headerlink\" title=\"提要\"></a>提要</h2><p>抽奖有多种实现方式 那么最常见的就是转盘了，通过扇区来决定奖项 此时奖品的概率和公平性就都体现了，但是在没有人数和概率规定的情况下显然不能够提现，这是想到了通过时间间隔来均分奖品，那么就通过时间和参与人虚拟了一个中奖概率同时体现了公平性，思路有了，如何实现呢？百度一下我就知道 下面记录一下看了之后的实现。</p>\n<h2 id=\"重点描述\"><a href=\"#重点描述\" class=\"headerlink\" title=\"重点描述\"></a>重点描述</h2><p>该抽奖主要是提现奖品的公平性和奖品的均匀分布 不会出现开始即抽完 后续无奖品 或 奖品有剩余的可能性。</p>\n<h2 id=\"实现如下\"><a href=\"#实现如下\" class=\"headerlink\" title=\"实现如下\"></a>实现如下</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.数据表</span><br><span class=\"line\">## 抽奖表</span><br><span class=\"line\">create table draw(</span><br><span class=\"line\">    id int not null auto_increment comment &apos;id&apos;,</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\t...</span><br><span class=\"line\">\tbegin_time datetime comment &apos;抽奖开始时间&apos;,</span><br><span class=\"line\">\tend_time datetime comment &apos;抽奖结束时间&apos;,</span><br><span class=\"line\">    primary key (id)\t</span><br><span class=\"line\">)</span><br><span class=\"line\">## 奖品表</span><br><span class=\"line\">create table prize(</span><br><span class=\"line\">    id int not null auto_increment comment &apos;id&apos;,</span><br><span class=\"line\">    name varchar(500) comment &apos;奖品名称&apos;,</span><br><span class=\"line\">    amount int comment &apos;奖品数量&apos;,</span><br><span class=\"line\">    balance int comment &apos;剩余数量&apos;,</span><br><span class=\"line\">    last_update_time datetime default CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP comment &apos;最后中奖时间&apos;,</span><br><span class=\"line\">    primary key (id)\t</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">## 中奖信息表</span><br><span class=\"line\">create table record(</span><br><span class=\"line\">    id int not null auto_increment comment &apos;id&apos;,</span><br><span class=\"line\">    prize_id int comment &apos;奖品id&apos;,</span><br><span class=\"line\">    release_time datetime default CURRENT_TIMESTAMP comment &apos;中奖时间&apos;,</span><br><span class=\"line\">    primary key (id)\t</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">2.代码实现</span><br><span class=\"line\">public static void getPrize()&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t//1. 首先获取当前抽奖的所有奖品是否还有剩余</span><br><span class=\"line\">\tif（getBalanceList == 0）&#123;</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;else&#123;</span><br><span class=\"line\">\t\t// 2. 随机一种用户可能抽中的奖品</span><br><span class=\"line\">\t\tprice = Random(...);</span><br><span class=\"line\">\t\tif(price.getBalance &lt;=0)&#123;</span><br><span class=\"line\">\t\t\treturn;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tlong beginTime = getBegin_time().getTime(); </span><br><span class=\"line\">        long endTime = getEnd_time().getTime(); </span><br><span class=\"line\">        long now = System.currentTimeMillis();</span><br><span class=\"line\"></span><br><span class=\"line\">        Integer currentAmount = getamount();                 // 总奖品数</span><br><span class=\"line\">    \tInteger currentBalance = getBalance();             // 总剩余数</span><br><span class=\"line\"></span><br><span class=\"line\">        long dataTime = (endTime - beginTime) / currentAmount;  // 时间单位</span><br><span class=\"line\">\t\tRandom rand = new Random(lastTime);</span><br><span class=\"line\">        long releaseTime = beginTime + (currentAmount - currentBalance) * dataTime + Math.abs(rand.nextLong()) % dataTime; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif(now&lt;releaseTime)&#123;</span><br><span class=\"line\">\t\t\t// 中奖</span><br><span class=\"line\">\t\t&#125;else&#123;</span><br><span class=\"line\">\t\t\treturn;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"end\"><a href=\"#end\" class=\"headerlink\" title=\"end\"></a>end</h2>","categories":[{"name":"后端","path":"api/categories/后端.json"}],"tags":[{"name":"抽奖","path":"api/tags/抽奖.json"}]}