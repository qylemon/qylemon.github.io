{"title":"linux部署及基础环境配置(二)","slug":"linux对nginx的安装与使用","date":"2020-03-04T15:05:00.913Z","updated":"2020-05-02T13:21:06.256Z","comments":true,"path":"api/articles/linux对nginx的安装与使用.json","excerpt":" [Figure] ","covers":["https://picabstract-preview-ftn.weiyun.com/ftn_pic_abs_v3/919141cbda346a1d323f3327aa596860d00dde78d02cd388f0e5afe48278ecc00dd9a7729b6102069011636b12c84f1d?pictype=scale&amp;from=30113&amp;version=3.3.3.3&amp;uin=1643994375&amp;fname=u%3D2805980902%2C2871858655%26fm%3D26%26gp%3D0.jpg&amp;size=750","https://upload-images.jianshu.io/upload_images/4424012-757bf8b721d4f65a.png"],"content":"<p><img src=\"https://picabstract-preview-ftn.weiyun.com/ftn_pic_abs_v3/919141cbda346a1d323f3327aa596860d00dde78d02cd388f0e5afe48278ecc00dd9a7729b6102069011636b12c84f1d?pictype=scale&amp;from=30113&amp;version=3.3.3.3&amp;uin=1643994375&amp;fname=u%3D2805980902%2C2871858655%26fm%3D26%26gp%3D0.jpg&amp;size=750\" alt><a id=\"more\"></a><br>单部署tomcat足够满足我们对后端项目的需要，但tomcat应当被理解为容器，要处理http server还应当更上一层 这时nginx是一个很好的选择</p>\n<h2 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h2><h3 id=\"安装前的准备\"><a href=\"#安装前的准备\" class=\"headerlink\" title=\"安装前的准备\"></a>安装前的准备</h3><ol>\n<li>需要依赖的环境gcc、pcre-devel、zlib-devel、openssl-devel<blockquote>\n<p>yum -y install gcc pcre-devel zlib-devel openssl openssl-devel</p>\n</blockquote>\n</li>\n</ol>\n<h3 id=\"开始安装\"><a href=\"#开始安装\" class=\"headerlink\" title=\"开始安装\"></a>开始安装</h3><p>在nginx官网下载一个tar.gz包 并移动到/usr/local下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">## 解压</span><br><span class=\"line\">tar -zxvf nginx-1.9.9.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">##进入nginx目录</span><br><span class=\"line\">cd nginx-1.9.9</span><br><span class=\"line\">## 配置</span><br><span class=\"line\">./configure --prefix=/usr/local/nginx</span><br><span class=\"line\"></span><br><span class=\"line\"># make</span><br><span class=\"line\">make &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"># cd到刚才配置的安装目录/usr/loca/nginx/</span><br><span class=\"line\">./sbin/nginx -t</span><br><span class=\"line\">出现success则为成功</span><br><span class=\"line\"></span><br><span class=\"line\">cd /usr/local/nginx/sbin</span><br><span class=\"line\">./nginx //启动nginx</span><br><span class=\"line\">``` </span><br><span class=\"line\">### 开机自启动</span><br><span class=\"line\">&gt; vi /etc/rc.d/rc.local</span><br><span class=\"line\"></span><br><span class=\"line\">![](https://images2015.cnblogs.com/blog/964175/201705/964175-20170521122817057-1077865607.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## 配置访问tomcat</span><br><span class=\"line\">&gt; vi /conf/nginx.conf</span><br><span class=\"line\"></span><br><span class=\"line\">![](https://images2015.cnblogs.com/blog/656746/201605/656746-20160510160506952-1299797999.png)</span><br><span class=\"line\"></span><br><span class=\"line\">将选中部分的tomcat_server换成你的端口，下方链接相同即可完成配置</span><br><span class=\"line\"></span><br><span class=\"line\">## 配置HTTPS访问</span><br><span class=\"line\">在配置https访问前需要准备以下三点</span><br><span class=\"line\">1. 查看你的nginx是否安装了`http_ssl_module`模块</span><br><span class=\"line\">2. 申请ssl证书</span><br><span class=\"line\">3. 查看是否开启443端口</span><br><span class=\"line\"></span><br><span class=\"line\">### 准备工作</span><br><span class=\"line\">查看是否开启端口非常简单</span><br><span class=\"line\">&gt; netstat -ano | grep 443</span><br><span class=\"line\"></span><br><span class=\"line\">申请证书也非常简单 各云上应该都有免费个人证书 规则填写即可签发</span><br><span class=\"line\"></span><br><span class=\"line\">#### 是否安装https模块</span><br><span class=\"line\">&gt; $ /usr/local/nginx/sbin/nginx -V  查看是否安装模块 在安装nginx编译时加上`--with-http_ssl_module`可以直接安装</span><br><span class=\"line\"></span><br><span class=\"line\">如果安装过 会出现 `configure arguments: --with-http_ssl_module`的字样，那么可以跳过安装步骤 下面记录以下 没有安装如何处理</span><br><span class=\"line\">#### 安装https模块</span><br><span class=\"line\">1. 先找到安装包的位置 如不记得 可以使用whereis或find的方式查找 cd到nginx安装包的根目录下，</span><br><span class=\"line\">&gt; ./configure --with-http_ssl_module  # 安装</span><br><span class=\"line\"></span><br><span class=\"line\">2. 然后进行`make`操作 注意！这里不需要make install 不然就会覆盖</span><br><span class=\"line\">3. 关闭掉现有的nginx服务器</span><br><span class=\"line\">&gt; /usr/local/nginx/sbin/nginx -s stop</span><br><span class=\"line\"></span><br><span class=\"line\">4. cp ./objs/nginx /usr/local/nginx/sbin/   # 将新编译好的版本覆盖原有的nginx</span><br><span class=\"line\">这时已经完成了大部分工作 在nginx.conf同级创建一个文件夹将证书的公私钥放入文件夹中 我们回头去修改nginx.conf 文件的443端口内容</span><br></pre></td></tr></table></figure></p>\n<p>vi /usr/local/nginx/conf/nginx.conf</p>\n<p>将443的server服务注释取消(如下方伪代码)<br>    server {<br>       listen       443 ssl ;<br>       server_name  xxx;</p>\n<p>　　　　ssl_certificate “/…/nginx/conf/xxx/1_<a href=\"http://www.xx.xxx.crt&quot;（你刚才传到服务器上的证书地址，叫你记住的哦）\" target=\"_blank\" rel=\"noopener\">www.xx.xxx.crt&quot;（你刚才传到服务器上的证书地址，叫你记住的哦）</a>;<br>　　　　ssl_certificate_key “/…/nginx/conf/xxx/2_<a href=\"http://www.xxx.xx.key&quot;（你刚才传到服务器上的证书地址）\" target=\"_blank\" rel=\"noopener\">www.xxx.xx.key&quot;（你刚才传到服务器上的证书地址）</a>;</p>\n<pre><code>······\n</code></pre><p>　　}<br><code>`</code><br>保存文件 然后重启nginx  重启前我们阔以通过 nginx -t 检查当前配置是否正常</p>\n<blockquote>\n<p>nginx -s reload</p>\n</blockquote>\n<h4 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h4><p>此时可能会出现 这样的画面<img src=\"https://upload-images.jianshu.io/upload_images/4424012-757bf8b721d4f65a.png\" alt><br>这是因为端口被占用 使用</p>\n<blockquote>\n<p>netstat -ntlp 查看被占用的端口<br>kill 进程号 再次重启即可</p>\n</blockquote>\n<h2 id=\"多项目部署\"><a href=\"#多项目部署\" class=\"headerlink\" title=\"多项目部署\"></a>多项目部署</h2><p>可以选择同容器部署，比如一个tomcat多项目，这里我选择了多tomcat单项目，需要在server.xml中修改三个默认监听端口，然后运行起来，在nginx.conf中新增一个server，和之前方式一样就可以了。</p>\n<h2 id=\"性能调优\"><a href=\"#性能调优\" class=\"headerlink\" title=\"性能调优\"></a>性能调优</h2><h2 id=\"Http跳转Https\"><a href=\"#Http跳转Https\" class=\"headerlink\" title=\"Http跳转Https\"></a>Http跳转Https</h2><p>如无特殊需求阔以同时访问 跳转可以参考301跳转</p>\n<h2 id=\"常用维护命令\"><a href=\"#常用维护命令\" class=\"headerlink\" title=\"常用维护命令\"></a>常用维护命令</h2><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">命令</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">./nginx -t</td>\n<td style=\"text-align:center\">查看当前配置是否书写正确</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">./nginx</td>\n<td style=\"text-align:center\">启动nginx</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">./nginx -s reload</td>\n<td style=\"text-align:center\">重启nginx</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">ps -ef &#124; grep nginx</td>\n<td style=\"text-align:center\">查看nginx进程</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">kill -QUIT 主进程号</td>\n<td style=\"text-align:center\">从容停止</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">kill -TERM 主进程号</td>\n<td style=\"text-align:center\">快速停止</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">kill -9 nginx</td>\n<td style=\"text-align:center\">强制停止</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"end\"><a href=\"#end\" class=\"headerlink\" title=\"end\"></a>end</h2>","more":"<br>单部署tomcat足够满足我们对后端项目的需要，但tomcat应当被理解为容器，要处理http server还应当更上一层 这时nginx是一个很好的选择</p>\n<h2 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h2><h3 id=\"安装前的准备\"><a href=\"#安装前的准备\" class=\"headerlink\" title=\"安装前的准备\"></a>安装前的准备</h3><ol>\n<li>需要依赖的环境gcc、pcre-devel、zlib-devel、openssl-devel<blockquote>\n<p>yum -y install gcc pcre-devel zlib-devel openssl openssl-devel</p>\n</blockquote>\n</li>\n</ol>\n<h3 id=\"开始安装\"><a href=\"#开始安装\" class=\"headerlink\" title=\"开始安装\"></a>开始安装</h3><p>在nginx官网下载一个tar.gz包 并移动到/usr/local下<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">## 解压</span><br><span class=\"line\">tar -zxvf nginx-1.9.9.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">##进入nginx目录</span><br><span class=\"line\">cd nginx-1.9.9</span><br><span class=\"line\">## 配置</span><br><span class=\"line\">./configure --prefix=/usr/local/nginx</span><br><span class=\"line\"></span><br><span class=\"line\"># make</span><br><span class=\"line\">make &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"># cd到刚才配置的安装目录/usr/loca/nginx/</span><br><span class=\"line\">./sbin/nginx -t</span><br><span class=\"line\">出现success则为成功</span><br><span class=\"line\"></span><br><span class=\"line\">cd /usr/local/nginx/sbin</span><br><span class=\"line\">./nginx //启动nginx</span><br><span class=\"line\">``` </span><br><span class=\"line\">### 开机自启动</span><br><span class=\"line\">&gt; vi /etc/rc.d/rc.local</span><br><span class=\"line\"></span><br><span class=\"line\">![](https://images2015.cnblogs.com/blog/964175/201705/964175-20170521122817057-1077865607.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## 配置访问tomcat</span><br><span class=\"line\">&gt; vi /conf/nginx.conf</span><br><span class=\"line\"></span><br><span class=\"line\">![](https://images2015.cnblogs.com/blog/656746/201605/656746-20160510160506952-1299797999.png)</span><br><span class=\"line\"></span><br><span class=\"line\">将选中部分的tomcat_server换成你的端口，下方链接相同即可完成配置</span><br><span class=\"line\"></span><br><span class=\"line\">## 配置HTTPS访问</span><br><span class=\"line\">在配置https访问前需要准备以下三点</span><br><span class=\"line\">1. 查看你的nginx是否安装了`http_ssl_module`模块</span><br><span class=\"line\">2. 申请ssl证书</span><br><span class=\"line\">3. 查看是否开启443端口</span><br><span class=\"line\"></span><br><span class=\"line\">### 准备工作</span><br><span class=\"line\">查看是否开启端口非常简单</span><br><span class=\"line\">&gt; netstat -ano | grep 443</span><br><span class=\"line\"></span><br><span class=\"line\">申请证书也非常简单 各云上应该都有免费个人证书 规则填写即可签发</span><br><span class=\"line\"></span><br><span class=\"line\">#### 是否安装https模块</span><br><span class=\"line\">&gt; $ /usr/local/nginx/sbin/nginx -V  查看是否安装模块 在安装nginx编译时加上`--with-http_ssl_module`可以直接安装</span><br><span class=\"line\"></span><br><span class=\"line\">如果安装过 会出现 `configure arguments: --with-http_ssl_module`的字样，那么可以跳过安装步骤 下面记录以下 没有安装如何处理</span><br><span class=\"line\">#### 安装https模块</span><br><span class=\"line\">1. 先找到安装包的位置 如不记得 可以使用whereis或find的方式查找 cd到nginx安装包的根目录下，</span><br><span class=\"line\">&gt; ./configure --with-http_ssl_module  # 安装</span><br><span class=\"line\"></span><br><span class=\"line\">2. 然后进行`make`操作 注意！这里不需要make install 不然就会覆盖</span><br><span class=\"line\">3. 关闭掉现有的nginx服务器</span><br><span class=\"line\">&gt; /usr/local/nginx/sbin/nginx -s stop</span><br><span class=\"line\"></span><br><span class=\"line\">4. cp ./objs/nginx /usr/local/nginx/sbin/   # 将新编译好的版本覆盖原有的nginx</span><br><span class=\"line\">这时已经完成了大部分工作 在nginx.conf同级创建一个文件夹将证书的公私钥放入文件夹中 我们回头去修改nginx.conf 文件的443端口内容</span><br></pre></td></tr></table></figure></p>\n<p>vi /usr/local/nginx/conf/nginx.conf</p>\n<p>将443的server服务注释取消(如下方伪代码)<br>    server {<br>       listen       443 ssl ;<br>       server_name  xxx;</p>\n<p>　　　　ssl_certificate “/…/nginx/conf/xxx/1_<a href=\"http://www.xx.xxx.crt&quot;（你刚才传到服务器上的证书地址，叫你记住的哦）\" target=\"_blank\" rel=\"noopener\">www.xx.xxx.crt&quot;（你刚才传到服务器上的证书地址，叫你记住的哦）</a>;<br>　　　　ssl_certificate_key “/…/nginx/conf/xxx/2_<a href=\"http://www.xxx.xx.key&quot;（你刚才传到服务器上的证书地址）\" target=\"_blank\" rel=\"noopener\">www.xxx.xx.key&quot;（你刚才传到服务器上的证书地址）</a>;</p>\n<pre><code>······\n</code></pre><p>　　}<br><code>`</code><br>保存文件 然后重启nginx  重启前我们阔以通过 nginx -t 检查当前配置是否正常</p>\n<blockquote>\n<p>nginx -s reload</p>\n</blockquote>\n<h4 id=\"注意点\"><a href=\"#注意点\" class=\"headerlink\" title=\"注意点\"></a>注意点</h4><p>此时可能会出现 这样的画面<img src=\"https://upload-images.jianshu.io/upload_images/4424012-757bf8b721d4f65a.png\" alt><br>这是因为端口被占用 使用</p>\n<blockquote>\n<p>netstat -ntlp 查看被占用的端口<br>kill 进程号 再次重启即可</p>\n</blockquote>\n<h2 id=\"多项目部署\"><a href=\"#多项目部署\" class=\"headerlink\" title=\"多项目部署\"></a>多项目部署</h2><p>可以选择同容器部署，比如一个tomcat多项目，这里我选择了多tomcat单项目，需要在server.xml中修改三个默认监听端口，然后运行起来，在nginx.conf中新增一个server，和之前方式一样就可以了。</p>\n<h2 id=\"性能调优\"><a href=\"#性能调优\" class=\"headerlink\" title=\"性能调优\"></a>性能调优</h2><h2 id=\"Http跳转Https\"><a href=\"#Http跳转Https\" class=\"headerlink\" title=\"Http跳转Https\"></a>Http跳转Https</h2><p>如无特殊需求阔以同时访问 跳转可以参考301跳转</p>\n<h2 id=\"常用维护命令\"><a href=\"#常用维护命令\" class=\"headerlink\" title=\"常用维护命令\"></a>常用维护命令</h2><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">命令</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">./nginx -t</td>\n<td style=\"text-align:center\">查看当前配置是否书写正确</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">./nginx</td>\n<td style=\"text-align:center\">启动nginx</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">./nginx -s reload</td>\n<td style=\"text-align:center\">重启nginx</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">ps -ef &#124; grep nginx</td>\n<td style=\"text-align:center\">查看nginx进程</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">kill -QUIT 主进程号</td>\n<td style=\"text-align:center\">从容停止</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">kill -TERM 主进程号</td>\n<td style=\"text-align:center\">快速停止</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">kill -9 nginx</td>\n<td style=\"text-align:center\">强制停止</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"end\"><a href=\"#end\" class=\"headerlink\" title=\"end\"></a>end</h2>","categories":[{"name":"Linux","path":"api/categories/Linux.json"}],"tags":[{"name":"环境部署","path":"api/tags/环境部署.json"},{"name":"nginx","path":"api/tags/nginx.json"}]}