{"title":"poi导出excel并作为附件发送JavaMail","slug":"poiMail","date":"2020-05-27T01:34:49.028Z","updated":"2020-06-11T06:15:58.220Z","comments":true,"path":"api/articles/poiMail.json","excerpt":null,"covers":null,"content":"<a id=\"more\"></a>\n<h2 id=\"实现思路\"><a href=\"#实现思路\" class=\"headerlink\" title=\"实现思路\"></a>实现思路</h2><p>之前已经记录过发送简易JavaMail和poi导出excel数据了 那么只需要将两步结合即可</p>\n<h2 id=\"实现如下\"><a href=\"#实现如下\" class=\"headerlink\" title=\"实现如下\"></a>实现如下</h2><ol>\n<li><p>因为我们之前是直接outputStream导出的 这里我们改导出方式为ByteArrayOutput</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ByteArrayOutputStream baos = new ByteArrayOutputStream();</span><br><span class=\"line\">// wb.write(output);</span><br><span class=\"line\">wb.write(baos);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>然后创建等大新的缓冲区并写入数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">byte[] bt = baos.toByteArray();</span><br><span class=\"line\">InputStream is = new ByteArrayInputStream(bt, 0, bt.length);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>将is的内容放入附件 之前记录了简单mail的发送这里改用MimeMessage的方式发送</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DataSource source = new ByteArrayDataSource(is, &quot;application/msexcel&quot;);</span><br><span class=\"line\">message.addAttachment(&quot;xxx.xls&quot;, source);</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"完整功能代码如下\"><a href=\"#完整功能代码如下\" class=\"headerlink\" title=\"完整功能代码如下\"></a>完整功能代码如下</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. mail</span><br><span class=\"line\">public void mailMsg(String content,InputStream is) throws Exception&#123;</span><br><span class=\"line\">    MimeMessage msg = mailSender.createMimeMessage();</span><br><span class=\"line\"></span><br><span class=\"line\">    MimeMessageHelper message = new MimeMessageHelper(msg, true);</span><br><span class=\"line\">    message.setFrom(Sender);   //邮件发送人</span><br><span class=\"line\"></span><br><span class=\"line\">    message.setTo(&quot;xxx@163.com&quot;);\t//接收</span><br><span class=\"line\">    message.setCc(&quot;xxx@163.com&quot;);\t//抄送</span><br><span class=\"line\">    message.setSubject(&quot;主题内容&quot;);</span><br><span class=\"line\">    message.setText(content);</span><br><span class=\"line\"></span><br><span class=\"line\">    //加入附件</span><br><span class=\"line\">    DataSource source = new ByteArrayDataSource(is, &quot;application/msexcel&quot;);</span><br><span class=\"line\">    message.addAttachment(&quot;xx.xls&quot;, source);</span><br><span class=\"line\"></span><br><span class=\"line\">    mailSender.send(msg);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">2. excel</span><br><span class=\"line\">HSSFWorkbook wb = new HSSFWorkbook();</span><br><span class=\"line\">try &#123;</span><br><span class=\"line\">    // 根据页面index 获取sheet页multipart</span><br><span class=\"line\">    HSSFSheet sheet = wb.createSheet(&quot;平台订单明细&quot;);</span><br><span class=\"line\">    sheet.setDefaultRowHeight((short) (10*30));</span><br><span class=\"line\">    sheet.setColumnWidth(0,25*512);</span><br><span class=\"line\">    HSSFPatriarch patriarch = sheet.createDrawingPatriarch();</span><br><span class=\"line\">    HSSFRow c = sheet.createRow(0);</span><br><span class=\"line\">    c.createCell(0).setCellValue(&quot;xx&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    for (int i = 0; i &lt; a.size(); i++) &#123;</span><br><span class=\"line\">        xx xxx = a.get(i);</span><br><span class=\"line\">        // 创建HSSFRow对象</span><br><span class=\"line\">        HSSFRow row = sheet.createRow(i + 1);</span><br><span class=\"line\">        // 创建HSSFCell对象 设置单元格的值</span><br><span class=\"line\">        row.createCell(0).setCellValue(xxx.xx());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ByteArrayOutputStream baos = new ByteArrayOutputStream();</span><br><span class=\"line\">//  wb.write(output);</span><br><span class=\"line\">    wb.write(baos);</span><br><span class=\"line\"></span><br><span class=\"line\">    byte[] bt = baos.toByteArray();</span><br><span class=\"line\">    InputStream is = new ByteArrayInputStream(bt, 0, bt.length);</span><br><span class=\"line\">    wb.close();</span><br><span class=\"line\"></span><br><span class=\"line\">    String content = &quot;测试内容 //这里是邮件内容&quot;;</span><br><span class=\"line\">    mailMsg(content,is);</span><br><span class=\"line\">&#125; catch (Exception e) &#123;</span><br><span class=\"line\">    e.printStackTrace();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"end\"><a href=\"#end\" class=\"headerlink\" title=\"end\"></a>end</h2>","more":"<h2 id=\"实现思路\"><a href=\"#实现思路\" class=\"headerlink\" title=\"实现思路\"></a>实现思路</h2><p>之前已经记录过发送简易JavaMail和poi导出excel数据了 那么只需要将两步结合即可</p>\n<h2 id=\"实现如下\"><a href=\"#实现如下\" class=\"headerlink\" title=\"实现如下\"></a>实现如下</h2><ol>\n<li><p>因为我们之前是直接outputStream导出的 这里我们改导出方式为ByteArrayOutput</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ByteArrayOutputStream baos = new ByteArrayOutputStream();</span><br><span class=\"line\">// wb.write(output);</span><br><span class=\"line\">wb.write(baos);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>然后创建等大新的缓冲区并写入数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">byte[] bt = baos.toByteArray();</span><br><span class=\"line\">InputStream is = new ByteArrayInputStream(bt, 0, bt.length);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>将is的内容放入附件 之前记录了简单mail的发送这里改用MimeMessage的方式发送</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DataSource source = new ByteArrayDataSource(is, &quot;application/msexcel&quot;);</span><br><span class=\"line\">message.addAttachment(&quot;xxx.xls&quot;, source);</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"完整功能代码如下\"><a href=\"#完整功能代码如下\" class=\"headerlink\" title=\"完整功能代码如下\"></a>完整功能代码如下</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. mail</span><br><span class=\"line\">public void mailMsg(String content,InputStream is) throws Exception&#123;</span><br><span class=\"line\">    MimeMessage msg = mailSender.createMimeMessage();</span><br><span class=\"line\"></span><br><span class=\"line\">    MimeMessageHelper message = new MimeMessageHelper(msg, true);</span><br><span class=\"line\">    message.setFrom(Sender);   //邮件发送人</span><br><span class=\"line\"></span><br><span class=\"line\">    message.setTo(&quot;xxx@163.com&quot;);\t//接收</span><br><span class=\"line\">    message.setCc(&quot;xxx@163.com&quot;);\t//抄送</span><br><span class=\"line\">    message.setSubject(&quot;主题内容&quot;);</span><br><span class=\"line\">    message.setText(content);</span><br><span class=\"line\"></span><br><span class=\"line\">    //加入附件</span><br><span class=\"line\">    DataSource source = new ByteArrayDataSource(is, &quot;application/msexcel&quot;);</span><br><span class=\"line\">    message.addAttachment(&quot;xx.xls&quot;, source);</span><br><span class=\"line\"></span><br><span class=\"line\">    mailSender.send(msg);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">2. excel</span><br><span class=\"line\">HSSFWorkbook wb = new HSSFWorkbook();</span><br><span class=\"line\">try &#123;</span><br><span class=\"line\">    // 根据页面index 获取sheet页multipart</span><br><span class=\"line\">    HSSFSheet sheet = wb.createSheet(&quot;平台订单明细&quot;);</span><br><span class=\"line\">    sheet.setDefaultRowHeight((short) (10*30));</span><br><span class=\"line\">    sheet.setColumnWidth(0,25*512);</span><br><span class=\"line\">    HSSFPatriarch patriarch = sheet.createDrawingPatriarch();</span><br><span class=\"line\">    HSSFRow c = sheet.createRow(0);</span><br><span class=\"line\">    c.createCell(0).setCellValue(&quot;xx&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    for (int i = 0; i &lt; a.size(); i++) &#123;</span><br><span class=\"line\">        xx xxx = a.get(i);</span><br><span class=\"line\">        // 创建HSSFRow对象</span><br><span class=\"line\">        HSSFRow row = sheet.createRow(i + 1);</span><br><span class=\"line\">        // 创建HSSFCell对象 设置单元格的值</span><br><span class=\"line\">        row.createCell(0).setCellValue(xxx.xx());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ByteArrayOutputStream baos = new ByteArrayOutputStream();</span><br><span class=\"line\">//  wb.write(output);</span><br><span class=\"line\">    wb.write(baos);</span><br><span class=\"line\"></span><br><span class=\"line\">    byte[] bt = baos.toByteArray();</span><br><span class=\"line\">    InputStream is = new ByteArrayInputStream(bt, 0, bt.length);</span><br><span class=\"line\">    wb.close();</span><br><span class=\"line\"></span><br><span class=\"line\">    String content = &quot;测试内容 //这里是邮件内容&quot;;</span><br><span class=\"line\">    mailMsg(content,is);</span><br><span class=\"line\">&#125; catch (Exception e) &#123;</span><br><span class=\"line\">    e.printStackTrace();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"end\"><a href=\"#end\" class=\"headerlink\" title=\"end\"></a>end</h2>","categories":[{"name":"后端","path":"api/categories/后端.json"}],"tags":[{"name":"SpringBoot","path":"api/tags/SpringBoot.json"},{"name":"POI","path":"api/tags/POI.json"},{"name":"Mail","path":"api/tags/Mail.json"}]}